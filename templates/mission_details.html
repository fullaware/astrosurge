{% extends "base.html" %}

{% block title %}Mission Details - {{ mission.name }}{% endblock %}

{% block content %}
    <div class="section">
        <h1>Mission Details: {{ mission.name }}</h1>
        <h2>{{ mission.asteroid_full_name }}</h2>
        <p><strong>Ship:</strong> <a href="/ships/{{ ship_id }}" style="color: #80deea;">{{ mission.ship_name }}</a></p>
        <p><strong>Total Yield:</strong> {{ mission.target_yield_kg }} kg</p>
        <p><strong>Revenue:</strong> ${{ "{:,.2f}".format(mission.revenue) }}</p>
        <p><strong>Total Expenses:</strong> ${{ "{:,.2f}".format(mission.cost + mission.penalties + mission.investor_repayment + mission.ship_repair_cost) }}</p>
        <p><strong>Profit:</strong> ${{ "{:,.2f}".format(mission.profit) }}</p>
        <p><strong>Days:</strong> {{ mission.total_duration_days }} (Scheduled: {{ mission.scheduled_days }})</p>
        <p><strong>Confidence:</strong> 
            {% if mission.confidence is not none %}
                {{ "%.2f"|format(mission.confidence) }}%
            {% else %}
                0.00%
            {% endif %}
            (Predicted Profit: Up to $
            {% if mission.predicted_profit_max is not none %}
                {{ "{:,.0f}".format(mission.predicted_profit_max) }}
            {% else %}
                0
            {% endif %})
        </p>
        <p><strong>Confidence Result:</strong> {{ mission.confidence_result|default('N/A') }}</p>
    </div>

    <div class="section">
        <h2>Mining Progress</h2>
        {{ mission.graph_html | safe }}
    </div>

    <div class="section event-list" style="max-height: 500px; overflow-y: auto;">
        <h2>Event Log</h2>
        {% for event in mission.events %}
        <p>
            Day {{ event.day|default('N/A') }}: {{ event.type }} - 
            {% if event.effect %}
            {% for key, value in event.effect.items() %}
            {{ key }}: {{ value }}{% if not loop.last %}, {% endif %}
            {% endfor %}
            {% else %}
            No effect
            {% endif %}
        </p>
        {% endfor %}
    </div>
{% endblock %}