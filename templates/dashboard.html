{% extends "base.html" %}

{% block title %}{{ mission.name }} - Asteroid Mining Operation Simulator{% endblock %}

{% block content %}
    <h1>{{ mission.name }} - Asteroid Mining Dashboard</h1>
    
    <div class="section">
        <h2>Mission Overview</h2>
        <p><strong>Company:</strong> {{ mission.company }}</p>
        <p><strong>Ship:</strong> {{ mission.ship_name }}</p>
        <p><strong>Asteroid:</strong> {{ mission.asteroid_full_name }}</p>
        <p><strong>Total Yield:</strong> {{ mission.target_yield_kg }} kg</p>
        <p><strong>Revenue:</strong> ${{ "{:,.2f}".format(mission.revenue) }}</p>
        <p><strong>Total Expenses:</strong> ${{ "{:,.2f}".format(mission.cost + mission.penalties + mission.investor_repayment + mission.ship_repair_cost) }}</p>
        <p><strong>Profit:</strong> ${{ "{:,.2f}".format(mission.profit) }}</p>
        <p><strong>Days:</strong> {{ mission.total_duration_days }} (Scheduled: {{ mission.scheduled_days }})</p>
        <p><strong>Confidence:</strong> {{ "%.2f"|format(mission.confidence) }}% (Predicted Profit: Up to ${{ "{:,.0f}".format(mission.predicted_profit_max) }})</p>
        <p><strong>Confidence Result:</strong> {{ mission.confidence_result }}</p>
    </div>

    <div class="section">
        <h2>Mining Progress</h2>
        {{ mission.graph_html | safe }}
    </div>

    <div class="section">
        <h2>Mined Elements</h2>
        <table>
            <tr>
                <th>Name</th>
                <th>Mass (kg)</th>
                <th>Atomic Number</th>
            </tr>
            {% for element in mission.elements %}
            <tr>
                <td>{{ element.name }}</td>
                <td>{{ element.mass_kg }}</td>
                <td>{{ element.number }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="section event-list">
        <h2>Events</h2>
        {% for event in mission.events %}
        <p>
            {% if event.day %}
            Day {{ event.day }}: {{ event.type }} - 
            {% else %}
            {{ event.type }} - 
            {% endif %}
            {% if event.effect %}
            {% for key, value in event.effect.items() %}
            {{ key }}: {{ value }}{% if not loop.last %}, {% endif %}
            {% endfor %}
            {% elif event.delay_days %}
            Delay Days: {{ event.delay_days }}
            {% else %}
            No effect
            {% endif %}
        </p>
        {% endfor %}
    </div>

    <div class="section daily-log">
        <h2>Daily Summaries</h2>
        {% for day in mission.daily_summaries %}
        <details>
            <summary>Day {{ day.day }}: {{ day.total_kg }} kg - {{ day.note }}</summary>
            {% if day.events %}
            <ul>
                {% for event in day.events %}
                <li>{{ event.type }}: 
                    {% if event.effect %}
                    {% for key, value in event.effect.items() %}{{ key }}: {{ value }}{% if not loop.last %}, {% endif %}{% endfor %}
                    {% else %}
                    No effect
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
            {% endif %}
        </details>
        {% endfor %}
    </div>
{% endblock %}